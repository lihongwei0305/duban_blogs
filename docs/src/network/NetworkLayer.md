## 概念：

1. 提供了通讯过程中必须使用的逻辑地址----IP地址
2. 负责连接不同的媒介类型
3. 根据运行的不同动态路由协议来选择不同的最佳路径
4. 在选择好的最佳路径上负责路由数据包

## IP地址的分类

1. A类【1 - 126】
2. B类【128 - 191】
3. C类【192 - 223】
4. D类【224 - 239】
5. E类【240 - 254】

### 私有网段

- 10.0.0.0 / 8
- 172.16.0.0 - 172.31.255.255 / 12
- 192.168.0.0 - 192.168.255.255 / 16

## 子网掩码

### 作用： 用来区分不同的网段的

## 路由器路由数据包的过程

1. 在不使用NAT的前提下，路由器路由数据包时，三层的源IP与目标IP地址始终保持不变化
2. 路由器会不断的使自身接口地址的MAC地址做二层重写，直至将数据报文路由至目的节点
3. 路由器每一个接口都有一个独立的MAC地址

## 单臂路由

#### 作用：用来实现不同VLAN且不同网段间的用户的通信

#### 核心技术：路由器划分子接口，在子接口上封装VLAN，并开启ARP广播功能

## 动态路由

### 动态路由协议的概念

1. 会从其他路由器那里接收路由信息
2. 会主动向其它路由器发送路由信息
3. 会利用接收到的路由信息来计算最佳路径，并生成路由表项
4. 会对网络的变化做出及时的调整，并将调整后的路由继续向下传递

## 动态路由协议的分类

### 1. 按使用的范围进行划分

        1. 内部网关路由协议【IGP】：RIP、IGRP、IS-IS --- 用于单一自治系统【AS】内决策路由协议
        2. 外部网关路由协议【EGP】：BGP --- 用于连接不同的【AS】，使之能够相互通讯

:::: tip
执行统一路由策略的一组设备的集合
::::

### 2. 按算法进行划分

        1. 距离矢量型路由协议：RIP
        2. 链路状态路由协议：OSPF、IS-IS
        3. 混合型路由协议

## RIP路由协议

- RIP是为TCP/IP环境中开发的第一个路由选择协议标准
- RIP是一个【距离 - 矢量】路由选择协议

### 工作原理

1. 运行RIP的路由器平均每隔30s发送整张路由表项给自身直连的邻居路由器
2. 当全网所有的路由器的路由表项到达高度一致的情况下，就称该网络完成了收敛，只有收敛的网络才能够正常的工作并路由数据包
3. RIP以跳数作为其唯一的选路度量依据
4. RIP最大支持15跳，16跳将会被标记为不可到达

### RIP的环路防止

1. RIP容易产生路由环路，为防止环路的发生，故使用水平分割机制
2. 水平分割是一种规则，该规则规定：从一个接口学习到的路由条目，就不在通过这个接口发送回去了，通过该方式防止路由环路的发生
3. 水平分割机制默认在接口上启用

### 有类路由与无类路由

1. 有类路由【Classful】：在通告路由时，不携带子网掩码
2. 无类路由【Classless】：在通告路由时，会携带子网掩码

### RIP的版本

1. RIPv1：有类路由，使用广播更新，更新地址：255.255.255.255
2. PIPv2：无类路由，使用组播更新，更新地址：224.0.0.9

## OSPF

### Router-ID

- 是在OSPF区域内唯一标识一台路由器的IP地址

### Router Id选取规则

- 首先,路由器选取它所有loopback接口上数值最高的IP地址
- 如果没有Loopback,就在所有物理端口中选取一个数值最高的IP地址

### OSPF维护的表项

1. 邻接关系表【邻居表】：保存着直连邻居的路由信息
2. 链路状态数据库表【Link State DataBase | LSDB】：全网最完整的链路信息
3. 路由表：保存着到达其他网络节点的最佳路径

### OSPF建立邻接关系的过程

- 7种状态：
    1. Down(初始状态):路由器还未建立邻居关系
    2. Init(初始状态):路由器发送hello报文,但未收到其他路由器的hello报文响应
    3. 2-Wwy(双向状态):路由器已收到其他路由器的hello报文,建立邻居关系
    4. Exstart(起始状态):协商主从关系
    5. Exchange(交换状态):交换各自路由的汇总信息
    6. Loading(加载状态): 互相发送链路状态请求报文
    7. Full(完全状态)
- 5种报文：
    1. Hello
    2. DBD/DD【DataBase Description】 数据库描述报文
    3. LSR【Link State Request】 链路状态请求报文
    4. LSU【Link State Update】 链路状态更新报文
    5. LSAck 链路状态确认报文

### OSPF的DR与BDR

1. DR 指定路由器
2. BDR 备份指定路由器
3. Drothers 其它路由器 只与DR和BDR邻接关系,Drothers之间保持邻居关系

#### DR与BDR的选举机制

1. 先看优先级,运行OSPF的路由默认优先级为1,取值范围0-255,且优先级越大越优小
2. 若优先级相同,则比较RID,RID最大的为DR,次大的为BDR

::::tip
优先级0不参与选举
::::

### OSPF组播地址

1. DR/BDR监听 224.0.0.6
2. Drothers监听224.0.0.5

::::tip
DR/BDR/Drothers的Hello包，统一发送到224.0.0.5
::::

```shell
# 当ospf启动后，给路由器设置routerID，会不生效，需要对ospf软重启
[HuaWei] ospf 1 router-id 1.1.1.1
<HuaWei> reset ospf 1 process
```

### OSPF 多区域应用及高级配置

#### OSPF 生成多区域作用

1. 加快路由的收敛速度
2. 改善网络的可扩展性

#### OSPF路由器类型

1. 内部路由器
2. 骨干路由器
3. 区域边界路由器【ABR】
4. 自治系统边界路由器【ASBR】

### OSPF 区域类型

1. 骨干区域
2. 非骨干区域
    1. 标准区域
        - 域内路由器学习域内路由,ABR学习域间路由,ASBR学习外部路由
    2. 末节/末梢区域（Stub）
        - 只学习域内和域间路由,外部路由通过ABR的缺省路由访问
    3. 完全末节区域（Totally Stubby）
        - 只学习域内路由,ABR注入缺省路由
    4. 非纯末节区域[NSSA]
        - 学习域内、本区域的ASBR、域间，不学习其它区域的ASBR
    5. 非纯完全末节区域
        - 只学习域内路由，本区域可以包含ASBR路由器，自身可以引入并学习外部路由；域间路由不在学习,其它区域引入的外部路由也不在学习了

### OSPF链路状态

#### OSPF链路状态通告LSA的类型

| 类型代码  | 名称描述      | 用途阐述                          |
|:-----:|-----------|-------------------------------|
| Type1 | 路由器LSA    | 由区域内的路由器发出                    |
| Type2 | 网络LSA     | 由区域的DR发出                      | 
| Type3 | 网络汇总LSA   | 由ABR发出，其它区域的汇总链路通告            | 
| Type4 | ASBR汇总LSA | 由ABR发出，用于通过ASBR信息             | 
| Type5 | AS外部LSA   | 由ASBR发出，用于通告外部路由              | 
| Type7 | NSSA外部LSA | 由NSSA区域的ASBR发出，用于通告本区域连接的外部路由 | 

## ACL【Access Control List | 访问控制列表】

### 访问控制列表的种类

1. 基本类型
    - 使用的表号为2000 - 2999
2. 高级类型
    - 使用的表号为 3000 - 3999
    - 可同时根据源IP地址、目标IP地址、源端口号码、目标端口号码来进行访问控制
3. 适配二层
    - 使用的表号为 4000 - 4999
    - 可同时根据源MAC地址、目标MAC地址进行访问控制
4. 基于时间
    - 可配合上诉的3种ACL类型协同工作

#### ACL配置距离

````text
# 
[HuaWei] acl 2001
[HuaWei-acl-basic-2001] rule deny source 192.168.1.0 0.0.0.255
[HuaWei] int g0/0/1
[HuaWei] traffic-filter inbound acl 2001
[HuaWei] rule deny source any    
````

## NAT

### NAT的4种实现方式

1. 静态转换
2. 动态转换
3. 端口多路复用[NAPT]
4. Easy IP

## IPv6

### 地址分配方式

1. 静态
    - 手动配置静态地址
2. 动态
    - 无状态地址自动配置（SLAAC）
    - 有状态地址自动配置（DHCPv6）
